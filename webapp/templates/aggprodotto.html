{% extends "base.html" %} {% block title %}Aggiungi il prodotto{% endblock %}

{% block content %}
<form method="POST" enctype="multipart/form-data">
    <br />
    <h3 align="center">Aggiungi il prodotto</h3>
    <div class="form-group">
        <label for="immagine">Immagine</label>
        <input type="file" class="form-control-file" id="immagine" name="immagine" accept="image/*" required/>
    </div>
    <div class="form-group">
        <label for="nome">Nome</label>
        <input type="text" class="form-control" id="nome" name="nome" placeholder="Inserisci il nome del prodotto" required/>
    </div>
    <div class="form-group">
        <label for="costo">Costo</label>
        <input type="double" class="form-control" id="costo" name="costo" placeholder="Inserisci il costo del prodotto" required/>
    </div>
    <div class="form-group">
        <label for="quantità">Quantità</label>
        <input type="integer" class="form-control" id="quantità" name="quantità" placeholder="Inserisci la quantità" required />
    </div>
    <div class="form-group">
        <label for="descrizione">Descrizione</label>
        <input type="text" class="form-control" id="descrizione" name="descrizione" placeholder="Inserisci la descrizione del prodotto" required/>
    </div>
    <div class="form-group">
        <label for="marca">Marca</label>
        <input type="text" class="form-control" id="marca" name="marca" placeholder="Inserisci la marca del prodotto" required/>
    </div>
    <div class="form-group">
        <label for="categoria">Categoria</label>
    <select name="categoria" id="categoria" required>
        <option value="">Seleziona una categoria</option>
        {% for categoria in categorie %}
            <option value="{{ categoria.idcategoria }}">{{ categoria.nome }}</option>
        {% endfor %}
    </select>

    <label for="sottocategoria">Sottocategoria</label>
    <select name="sottocategoria" id="sottocategoria" required>
        <option value="">Seleziona una sottocategoria</option>
    </select>
    </div>   
    <br />
    <button type="submit" class="btn btn-success">Aggiungi</button>
</form>

<script>
    document.getElementById('categoria').addEventListener('change', function () {
        const categoriaId = this.value;
        const sottocategoriaSelect = document.getElementById('sottocategoria');
        
        fetch('/get_sottocategorie?categoria_id=' + categoriaId)
            .then(response => response.json())
            .then(data => {
                sottocategoriaSelect.innerHTML = '<option value="">Seleziona una sottocategoria</option>';
                data.sottocategorie.forEach(sottocategoria => {
                    const option = document.createElement('option');
                    option.value = sottocategoria.id;
                    option.textContent = sottocategoria.nome;
                    sottocategoriaSelect.appendChild(option);
                });
            });
    });
    </script>
{% endblock %}