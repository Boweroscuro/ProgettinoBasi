{% extends "base.html" %}

{% block title %}Crea Categoria{% endblock %}

{% block content %}
<div class="container">
    <h3>Aggiungi una nuova categoria</h3>
    <form id="category-form" method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="nome">Nome Categoria</label>
            <input type="text" class="form-control" id="nome" name="nome" placeholder="Inserisci il nome della categoria" required>
        </div>
        <div class="form-group">
            <label for="immagine">Immagine Categoria</label>
            <input type="file" class="form-control-file" id="immagine" name="immagine" accept="image/*" required>
        </div>
        <div class="form-group">
            <label for="tipo">Tipo Categoria</label>
            <select class="form-control" id="tipo" name="tipo" required>
                <option value="principale">Categoria Principale</option>
                <option value="sottocategoria">Sottocategoria di:</option>
            </select>
        </div>
        <div class="form-group" id="select-genitore" style="display: none;">
            <label for="genitore">Categoria Genitore</label>
            <select class="form-control" id="idgenitore" name="idgenitore">
                <!-- Inserisci le opzioni per le categorie principali tramite un ciclo for -->
                {% for categoria in categorie_principali %}
                    <option value="{{ categoria.idcategoria }}">{{ categoria.nome }}</option>
                {% endfor %}
            </select>
        </div>
        <!-- Hidden input to handle idgenitore clearing -->
        <input type="hidden" id="hidden_idgenitore" name="hidden_idgenitore" value="">
        <button type="submit" class="btn btn-primary">Aggiungi Categoria</button>
    </form>
</div>

<script>
    document.getElementById('tipo').addEventListener('change', function() {
        var selectGenitore = document.getElementById('select-genitore');
        var idgenitore = document.getElementById('idgenitore');
        var hiddenIdgenitore = document.getElementById('hidden_idgenitore');
        if (this.value === 'sottocategoria') {
            selectGenitore.style.display = 'block';
            idgenitore.required = true;
        } else {
            selectGenitore.style.display = 'none';
            idgenitore.required = false;
            idgenitore.value = ''; // Clear the value of idgenitore
            hiddenIdgenitore.value = 'NULL'; // Set hidden input to indicate NULL
        }
    });

    document.getElementById('category-form').addEventListener('submit', function(event) {
        var tipo = document.getElementById('tipo').value;
        var idgenitore = document.getElementById('idgenitore');
        var hiddenIdgenitore = document.getElementById('hidden_idgenitore');
        if (tipo === 'principale') {
            idgenitore.value = ''; // Ensure the idgenitore value is cleared
            hiddenIdgenitore.value = 'NULL'; // Set hidden input to indicate NULL
        } else {
            hiddenIdgenitore.value = ''; // Clear hidden input for valid idgenitore
        }
    });
</script>
{% endblock %}
